<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Random Tab Hopper</title>

  <style>
    :root{
      --bg:#121417; --panel:#1b1f26; --text:#e8ecf1; --muted:#9aa6b2;
      --ok:#35d07f; --warn:#ffb84d; --danger:#ff6b6b; --accent:#5aa9ff;
      --track:#2a313b; --track-fill:#3a6fb2; --thumb:#e8ecf1;
      --btn-gloss-top:rgba(255,255,255,.18); --btn-gloss-bot:rgba(255,255,255,.06);
    }

    html,body{
      background:var(--bg);
      color:var(--text);
    }
    body{
      font:12px/1.3 system-ui,Segoe UI,Roboto,sans-serif;
      margin:6px;
      width:340px;
    }

    .card{
      position:relative;
      background:var(--panel);
      border-radius:12px;
      padding:8px;
      box-shadow:0 4px 14px rgba(0,0,0,.35);
    }

    .card-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:4px;
    }

    h3{
      margin:0;
      font-weight:600;
      letter-spacing:.2px;
      font-size:13px;
    }

    .row{
      display:grid;
      grid-template-columns:1fr 140px;
      gap:6px;
      margin:4px 0;
      align-items:center;
    }

    label{
      color:var(--muted);
      font-weight:600;
      font-size:11px;
    }

    input[type=number]{
      width:100%;
      padding:3px 5px;
      border-radius:8px;
      border:1px solid #2a313b;
      background:#11161b;
      color:var(--text);
      font-size:11px;
    }

    input[type=range]{ width:100%; }
    .muted{ color:var(--muted); font-size:10px; }

    .toolbar{
      display:flex;
      gap:6px;
      margin-top:6px;
    }

    .btn{
      flex:1;
      padding:6px 7px;
      border-radius:10px;
      border:1px solid #2b3340;
      background:
        linear-gradient(180deg,var(--btn-gloss-top),var(--btn-gloss-bot)),
        linear-gradient(180deg,#2a3240,#1e2633);
      color:var(--text);
      cursor:pointer;
      user-select:none;
      transition:transform .06s ease, box-shadow .06s ease, opacity .08s ease;
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.05),
        0 2px 6px rgba(0,0,0,.3);
      font-size:11px;
    }

    .btn:hover{
      transform:translateY(-1px);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.08),
        0 3px 8px rgba(0,0,0,.35);
    }

    .btn:active{
      transform:translateY(1px);
      box-shadow:
        inset 0 2px 4px rgba(0,0,0,0.6),
        0 0 2px rgba(0,0,0,0.5);
      filter:brightness(0.85);
      border-color:#111;
    }

    .btn-accent{
      border-color:#2d5f9e;
      background:linear-gradient(180deg,#3a6fb2,#234a7c);
    }
    .btn-ok{
      border-color:#147a46;
      background:linear-gradient(180deg,#3ac082,#1f7a4f);
    }
    .btn-warn{
      border-color:#a66a11;
      background:linear-gradient(180deg,#e6a23c,#9b671b);
    }
    .btn-danger{
      border-color:#8a2222;
      background:linear-gradient(180deg,#e06565,#962d2d);
    }

    .toggle{
      padding:3px 8px;
      border-radius:9px;
      border:1px solid #2b3340;
      background:#1a1f29;
      color:var(--text);
      font-size:10px;
      cursor:pointer;
    }

    .toggle.on{
      background:#2b7030;
      border-color:#4c9b3e;
    }

    .status{
      margin-top:4px;
      font-weight:600;
      font-size:11px;
    }
    .running{ color:var(--ok); }
    .paused{ color:var(--warn); }
    .stopped{ color:var(--danger); }

    .section-disabled{
      opacity:0.45;
      pointer-events:none;
    }

    /* ---------- DUAL SLIDER ---------- */

    .range-block{ grid-column:1/-1; margin-top:2px; }

    .range-wrap{
      position:relative;
      height:30px;
    }

    .track{
      position:absolute;
      left:6px; right:6px;
      top:12px;
      height:5px;
      border-radius:5px;
      background:var(--track);
      z-index:1;
    }

    .track-fill{
      position:absolute;
      top:12px;
      height:5px;
      border-radius:5px;
      background:var(--track-fill);
      z-index:2;
    }

    .range{
      position:absolute;
      left:0; right:0;
      appearance:none;
      background:transparent;
      pointer-events:auto;
    }

    .range.min-handle{
      top:0;
      height:15px;
      z-index:3;
    }

    .range.max-handle{
      bottom:0;
      height:15px;
      z-index:3;
    }

    .range::-webkit-slider-thumb{
      appearance:none;
      width:11px;
      height:11px;
      border-radius:50%;
      background:var(--thumb);
      border:1px solid #000;
      box-shadow:0 0 0 2px rgba(0,0,0,.15);
    }

    .range::-moz-range-thumb{
      width:11px;
      height:11px;
      border-radius:50%;
      background:var(--thumb);
      border:1px solid #000;
      box-shadow:0 0 0 2px rgba(0,0,0,.15);
    }

    .range::-webkit-slider-runnable-track,
    .range::-moz-range-track{
      background:transparent;
    }

    .range.disabled{
      filter:grayscale(1) brightness(.7);
    }

    .endcaps{
      display:flex;
      justify-content:space-between;
      margin-top:1px;
      font-size:10px;
      color:var(--muted);
    }

    /* ---------- MODE SLIDER ---------- */

    .mode-switch{
      display:flex;
      justify-content:flex-end;
    }

    .mode-pill{
      display:flex;
      background:#0f1319;
      border-radius:999px;
      padding:2px;
      border:1px solid #2b3340;
      width:140px;
    }

    .mode-option{
      flex:1;
      border:none;
      border-radius:999px;
      background:transparent;
      color:var(--muted);
      font-size:10px;
      padding:3px 0;
      cursor:pointer;
    }

    .mode-option.active{
      background:var(--accent);
      color:#ffffff;
      box-shadow:0 0 4px rgba(0,0,0,.6);
    }

    .btn-chooser-idle{
      border-color:#a66a11;
      background:linear-gradient(180deg,#e6a23c,#9b671b);
    }
    .btn-chooser-active{
      border-color:#147a46;
      background:linear-gradient(180deg,#3ac082,#1f7a4f);
    }

    /* ---------- HOTKEY OVERLAY ---------- */

    .hotkey-btn{
      font-size:9px;
      padding:2px 6px;
      border-radius:8px;
      border:1px solid #2b3340;
      background:#11161b;
      color:var(--muted);
      cursor:pointer;
    }

.hotkey-panel{
  position:absolute;
  inset:6px;
  border-radius:10px;
  background:#11161b;
  box-shadow:0 6px 16px rgba(0,0,0,.7);
  padding:8px;
  display:none;
  z-index:20;
  font-size:11px;
  /* Important: don’t intercept clicks when hidden */
  pointer-events:none;
}

.hotkey-panel.visible{
  display:block;
  pointer-events:auto; /* only clickable when actually shown */
}


    .hotkey-panel-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:4px;
    }

    .hotkey-panel-header h4{
      margin:0;
      font-size:12px;
      font-weight:600;
    }

    .hotkey-close{
      border:none;
      background:transparent;
      color:var(--muted);
      cursor:pointer;
      font-size:13px;
      padding:2px 4px;
    }

    .hotkey-section-title{
      font-weight:600;
      margin:4px 0 1px;
      color:var(--muted);
      font-size:10px;
    }

    .hotkey-list{
      margin:0 0 2px;
      padding-left:12px;
    }

    .hotkey-list li{
      margin:1px 0;
    }

    .kbd{
      display:inline-block;
      padding:1px 4px;
      border-radius:3px;
      border:1px solid #3b3f46;
      background:#181c22;
      font-size:10px;
      margin-right:3px;
    }
  </style>
</head>
<body>

  <div class="card">
    <div class="card-header">
      <h3>Random Tab Hopper</h3>
      <button id="hotkeyHelpBtn" class="hotkey-btn">Hotkeys</button>
    </div>

    <!-- HOTKEY OVERLAY -->
    <div id="hotkeyPanel" class="hotkey-panel">
      <div class="hotkey-panel-header">
        <h4>Keyboard shortcuts</h4>
        <button id="hotkeyCloseBtn" class="hotkey-close">✕</button>
      </div>

      <div class="hotkey-section-title">On normal pages (while running)</div>
      <ul class="hotkey-list">
        <li><span class="kbd">Space</span> Stop (if “Stop on human input” is enabled)</li>
        <li><span class="kbd">→</span> Jump to next included tab immediately</li>
        <li><span class="kbd">←</span> Go back to the previously shown tab in this run</li>
        <li><span class="kbd">P</span> Pause</li>
        <li><span class="kbd">Enter</span> Resume</li>
        <li><span class="kbd">S</span> Stop (same as the Stop button)</li>
        <li><span class="kbd">C</span> Close all included tabs from the last run (when not running)</li>
      </ul>

      <div class="hotkey-section-title">Inside this popup</div>
      <ul class="hotkey-list">
        <li><span class="kbd">Enter</span> Start (when stopped) or resume (when paused)</li>
        <li><span class="kbd">→</span> Jump to next included tab (while running)</li>
        <li><span class="kbd">←</span> Go back to the previously shown tab (while running)</li>
        <li><span class="kbd">C</span> Close all included tabs from the last run</li>
      </ul>
    </div>

    <!-- TAB RANGE SECTION -->
    <div id="rangeSection">
      <div class="row">
        <label>Tab start</label>
        <input id="tabStart" type="number" min="1" value="1" />
      </div>
      <div class="row">
        <label>Tab end</label>
        <input id="tabEnd" type="number" min="1" value="9" />
      </div>
      <div class="muted" id="rangeNote">
        Using tab range (manual tab list disabled).
      </div>
    </div>

    <div class="row" style="margin-top:4px;">
      <label>Seconds per tab</label>
      <input id="seconds" type="number" min="0.1" step="0.1" value="5" />
    </div>

    <!-- TIMING VARIANCE (PERCENT) -->
    <div class="row">
      <label id="jitterLabel">Timing Variance (±0%)</label>
      <button id="jitterToggle" class="toggle" aria-pressed="false">OFF</button>
    </div>
    <div class="row">
      <span class="muted">Variance amount</span>
      <div style="display:flex;gap:6px;align-items:center">
        <input id="jitterRange" type="range" min="0" max="100" step="1" value="25" />
        <span id="jitterValue" class="muted">25%</span>
      </div>
    </div>

    <!-- CUSTOM VARIANCE RANGE -->
    <div class="row">
      <label>Custom Variance Range (seconds)</label>
      <button id="rangeToggle" class="toggle" aria-pressed="false">OFF</button>
    </div>

    <div class="range-block">
      <div class="range-wrap" aria-label="Custom variance range">
        <div class="track"></div>
        <div class="track-fill" id="trackFill" style="left:6%;right:86.7%"></div>

        <input id="minRange" class="range min-handle disabled"
               type="range" min="0.5" max="30" step="0.5" value="1.0">

        <input id="maxRange" class="range max-handle disabled"
               type="range" min="0.5" max="30" step="0.5" value="2.0">
      </div>

      <div class="endcaps">
        <span>Min: <span id="minLabel">1.0s</span></span>
        <span>Max: <span id="maxLabel">2.0s</span></span>
      </div>

      <div class="muted">
        Randomly offsets the base time earlier or later within this range.
      </div>
    </div>

    <!-- MANUAL TAB LIST -->
    <div id="manualSection" style="margin-top:4px;">
      <div class="row">
        <label>Manual tab list</label>
        <button id="useListToggle" class="toggle" aria-pressed="false">OFF</button>
      </div>
      <div class="row">
        <span class="muted">Selection</span>
        <div style="display:flex;gap:4px;justify-content:flex-end">
          <button id="chooseTabsBtn"
                  class="btn btn-chooser-idle"
                  style="padding:4px 6px;flex:0 0 auto;">
            Choose
          </button>
          <button id="clearMarkersBtn"
                  class="btn btn-danger"
                  style="padding:4px 6px;flex:0 0 auto;">
            Clear
          </button>
        </div>
      </div>

      <div class="muted" id="manualNote">
        Manual tab list disabled (using tab range).
      </div>
    </div>

    <div class="row" style="margin-top:3px;">
      <label>Total minutes</label>
      <input id="totalMinutes" type="number" min="0.1" step="0.1" value="3" />
    </div>

    <!-- MODE SLIDER -->
    <div class="row">
      <label>Mode</label>
      <div class="mode-switch">
        <div class="mode-pill" id="modeSwitch">
          <button class="mode-option active" data-mode="random">Random</button>
          <button class="mode-option" data-mode="sequential">Sequential</button>
        </div>
      </div>
    </div>

    <div class="row">
      <label>Stop on human input</label>
      <input id="stopOnHuman" type="checkbox" checked />
    </div>
    <div class="muted">
      Space or switching to another tab yourself stops hopping.
    </div>

    <!-- CLEANUP BUTTON NEAR THE BOTTOM -->
    <div style="text-align:center; margin:6px 0 4px;">
      <button id="closeLastRunBtn"
              class="btn btn-danger"
              style="width:78%; margin:auto;">
        Close included tabs
      </button>
    </div>

    <!-- START / PAUSE / STOP -->
    <div class="toolbar">
      <button id="startBtn" class="btn btn-ok">Start</button>
      <button id="pauseResumeBtn" class="btn btn-warn">Pause</button>
      <button id="stopBtn" class="btn btn-danger">Stop</button>
    </div>

    <div id="status" class="status stopped">Stopped</div>
  </div>

  <script src="popup.js"></script>
</body>
</html>
